# Math4Kids 项目上下文

## 项目概述

这是一个面向三年级小学生的数学游戏项目，采用小鱼主题，通过互动游戏帮助孩子们练习数学计算，特别关注计算易错点。项目已完成两套单页游戏的开发，采用 HTML5 + 原生 JavaScript + CSS3 实现，无需外部依赖，可直接在浏览器中运行。

## 项目类型

代码项目 - 这是一个已完成的 Web 游戏项目，包含两个完整的单页数学游戏实现。

## 目录结构

```
/documents/interest/math4kids/
├── fish-game.html      # 《小鱼觅食大挑战》游戏
├── fish-racing.html    # 《海底数字捕鱼赛》游戏
├── fish-game.md        # 游戏设计文档
└── IFLOW.md            # 项目上下文文件（本文件）
```

## 已实现游戏

### 1. fish-game.html - 《小鱼觅食大挑战》

**游戏类型**：答题进阶类

**核心玩法**：
- 通过答对计算题为小鱼收集"能量虾"
- 累计能量解锁不同品种的小鱼伙伴
- 点击游动的能量虾，弹出答题框输入答案

**主要功能**：
- 浅蓝色海底背景，带有波纹和泡泡动画
- 底部中央的卡通小鱼主角，头顶显示能量值
- 能量虾随机游动，每只虾绑定一道计算题
- 能量虾难度系统：3个难度等级，通过大小和颜色区分（橙色=难度1，深橙色=难度2，橙红色=难度3）
- 答对：虾消失，能量+1，播放音效，显示"真棒！"
- 答对难题（难度2或3）：小鱼显示开心表情动画
- 答错：显示易错点提示，可重新答题
- 升级系统：每5分升一级，共7个等级，每个等级解锁新的皮肤和更大的尺寸

**升级系统详情**：
- **等级1（0-4分）**：初始小鱼（红色，尺寸1.0倍）
- **等级2（5-9分）**：彩虹鱼（彩虹渐变，尺寸1.1倍）
- **等级3（10-14分）**：斑点鱼（绿色带蓝色斑点，尺寸1.2倍）
- **等级4（15-19分）**：彩虹斑点鱼（彩虹渐变+斑点，尺寸1.3倍）
- **等级5（20-24分）**：金色鱼（金色渐变+发光效果，尺寸1.4倍）
- **等级6（25-29分）**：钻石鱼（钻石光泽+闪烁效果，尺寸1.5倍）
- **等级7（30+分）**：传奇鱼（彩虹流光+星星点缀+发光+特殊动画，尺寸1.6倍）

**皮肤特效**：
- **彩虹鱼**：彩虹渐变背景（红→橙→绿→蓝→紫）
- **斑点鱼**：绿色背景带蓝色斑点图案
- **彩虹斑点鱼**：彩虹渐变+蓝色斑点
- **金色鱼**：金色渐变背景，持续发光闪烁（goldShimmer动画）
- **钻石鱼**：钻石光泽，光线扫过效果（diamondShine动画）
- **传奇鱼**：彩虹流光渐变（300%背景大小）、星星点缀、持续脉冲动画、尾巴摆动更明显

**技术特点**：
- CSS @keyframes 实现虾的游动和泡泡上浮动画
- 30道易错题型题库，按三阶段难度递进设计（二年级基础→进阶→三年级上学期）
- 能量虾难度系统：通过CSS类名控制大小和颜色（difficulty-1/2/3）
- 尺寸等级系统：通过CSS类名控制小鱼尺寸（scale-1到scale-7）
- 数字键盘适配触屏操作，支持键盘输入（0-9、Backspace、Enter、Escape）
- Web Audio API 生成正确（C5）/错误（G3）/解锁（E5）音效
- 小鱼表情动画：答对难题时触发开心表情（嘴巴和眼睛动画）
- 题目按顺序循环使用，实现难度递进
- 响应式设计，支持手机/平板

**运行方式**：
直接在浏览器中打开 `fish-game.html` 文件即可开始游戏。

### 2. fish-racing.html - 《海底数字捕鱼赛》

**游戏类型**：快速反应类

**核心玩法**：
- 快速计算题目，点击对应答案的小鱼
- 考验计算速度与准确率
- 10秒倒计时机制

**主要功能**：
- 深蓝色海底背景，带有随机分布的白色气泡
- 顶部固定显示题目区域和10秒倒计时
- 右上角计分板显示得分和连击数
- 3-5条彩色小鱼随机游动（红色=加减法，黄色=乘法，绿色=混合）
- 答对：小鱼消失，得分+1，倒计时重置，刷新新题目
- 答错/超时：弹出提示，题目不刷新，倒计时重新开始
- 连击奖励：每连续答对3题，额外+1分

**技术特点**：
- JS随机生成小鱼位置和游动轨迹
- 小鱼颜色系统：红色=加减法、黄色=乘法、绿色=混合题型（用于干扰项）
- 题型区分：通过 questionBank 中的 type 标记（addition/subtraction/multiplication）
- 无需音效，用屏幕闪烁替代（绿色=答对，红色=答错/超时）
- 倒计时系统：10秒倒计时，最后3秒变红色警告
- 连击奖励系统：每连续答对3题，额外+1分
- 答案生成算法：生成正确答案+4个干扰项，在正确答案±100范围内随机
- 响应式设计，支持手机/平板
- 30道易错题型题库

**运行方式**：
直接在浏览器中打开 `fish-racing.html` 文件即可开始游戏。

## 技术栈

- **前端技术**：HTML5 + 原生 JavaScript + CSS3
- **动画实现**：CSS @keyframes
- **音效**：Web Audio API（仅 fish-game.html）
- **部署方式**：单页HTML文件，无需外部依赖
- **适配平台**：支持本地打开、内网共享、trae/opencode/iflow等低代码平台

## 题库内容

两个游戏各包含30道易错题型，按难度递进设计：

### fish-game.html 题库（30题，三阶段递进）
- **第一阶段（1-10题）**：二年级基础 - 100以内不进位/不退位加减法、表内乘法（难度等级1）
- **第二阶段（11-20题）**：二年级进阶 - 100以内进位/退位加减法、简单乘法（难度等级2）
- **第三阶段（21-30题）**：三年级上学期 - 万以内加减法、多位数乘一位数（难度等级3）
- **特性**：每道题配备提示信息，题目按顺序循环使用，实现难度递进

### fish-racing.html 题库（30题）
- **万以内加减法**：如 358+276=634, 723-456=267
- **多位数乘一位数**：如 205×4=820, 156×3=468
- **类型标记**：每道题标记为 addition/subtraction/multiplication

## 设计特点

1. **目标用户**：三年级小女孩，采用小鱼主题吸引兴趣
2. **题型覆盖**：
   - 万以内加减法
   - 多位数乘一位数
   - 其他计算易错点
3. **交互设计**：
   - 触屏友好
   - 操作极简
   - 即时反馈（答对/答错提示）
4. **激励机制**：
   - 能值累计系统（fish-game.html）
   - 小鱼皮肤解锁（fish-game.html）- 7个等级，6种皮肤
   - 小鱼尺寸增长（fish-game.html）- 1.0倍到1.6倍
   - 连击奖励（fish-racing.html）
   - 倒计时挑战（fish-racing.html）

## 使用方式

### 运行游戏

**方式一：本地打开**
```bash
# 在浏览器中直接打开HTML文件
open fish-game.html      # macOS
xdg-open fish-game.html  # Linux
start fish-game.html     # Windows
```

**方式二：内网共享**
```bash
# 使用Python启动简单HTTP服务器
python3 -m http.server 8000

# 然后在其他设备上访问
# http://<本机IP>:8000/fish-game.html
# http://<本机IP>:8000/fish-racing.html
```

### 游戏选择建议

- **《小鱼觅食大挑战》**（fish-game.html）：
  - 适合需要成就感激励的学习过程
  - 注重答题准确性和易错点学习
  - 操作节奏较慢，适合专注练习
  - 7个等级升级系统，持续激励

- **《海底数字捕鱼赛》**（fish-racing.html）：
  - 适合碎片化时间练习（如作业间隙10分钟）
  - 注重计算速度和反应能力
  - 操作节奏轻快，适合快速练习

## 代码架构

### fish-game.html 架构
- **题库模块**：questionBank 数组存储30道题目，按三阶段难度递进排列，每题包含 question、answer、tip、difficulty 四个属性
- **游戏状态管理**：energy, currentQuestion, currentShrimp, gameStarted, currentQuestionIndex（用于难度递进）
- **难度系统**：通过 currentQuestionIndex 按顺序取题，循环使用题库实现难度递进
- **升级系统**：每5分升一级，共7个等级（0-4分/5-9分/10-14分/15-19分/20-24分/25-29分/30+分）
- **皮肤系统**：6种皮肤（初始/彩虹/斑点/彩虹斑点/金色/钻石/传奇），通过CSS类名控制
- **尺寸系统**：7个尺寸等级（scale-1到scale-7），从1.0倍到1.6倍
- **音效系统**：Web Audio API 生成正确（C5）/错误（G3）/解锁（E5）音效
- **动画系统**：CSS动画实现波纹、泡泡、虾游动；小鱼表情动画（happy类控制嘴巴和眼睛缩放）；皮肤特效动画（goldShimmer/diamondShine/legendaryBody等）
- **交互系统**：点击检测、答题判断、能量更新、皮肤解锁、键盘支持
- **能量虾系统**：根据题目难度等级添加 difficulty-1/2/3 类名，控制大小和颜色

### fish-racing.html 架构
- **题库模块**：questionBank 数组存储30道题目，每题包含 question、answer、type（addition/subtraction/multiplication）三个属性
- **游戏状态管理**：score, combo, currentQuestion, timeLeft, gameStarted, fishElements（存储当前小鱼元素）
- **计时系统**：10秒倒计时，自动重置，最后3秒变红色警告
- **答案生成算法**：generateAnswers() 生成正确答案+4个干扰项，在正确答案±100范围内随机，避免重复
- **题型系统**：根据题目类型分配小鱼颜色（乘法=黄色，加减法=红色/绿色混合）
- **动画系统**：JS动态生成小鱼游动轨迹（fishSwim1/fishSwim-1 动画）
- **反馈系统**：屏幕闪烁效果（绿=正确，红=错误/超时），弹出文字反馈

## 扩展和定制

### 修改题库

**fish-game.html 题库格式**：
```javascript
{ question: "题目", answer: 答案, tip: "提示信息", difficulty: 难度等级 }
```
- difficulty: 1（二年级基础）、2（二年级进阶）、3（三年级上学期）
- 题目按难度递进排列，修改时注意保持这个顺序

**fish-racing.html 题库格式**：
```javascript
{ question: "题目", answer: 答案, type: "题型" }
```
- type: "addition"（加法）、"subtraction"（减法）、"multiplication"（乘法）

在 HTML 文件的 `<script>` 标签中找到 `questionBank` 数组，可以：
- 添加新题目
- 修改现有题目
- 调整题目难度分布

### 调整游戏参数

**fish-game.html 可调参数**：
- 升级间隔：修改 `updateEnergy()` 函数中的 `const level = Math.floor(energy / 5) + 1`（当前为每5分升一级）
- 虾的数量：调整 `createShrimp()` 中的数量限制（当前最多5只）
- 创建虾的间隔：修改 setInterval 中的时间（当前为3000ms）
- 难度递进：修改 questionBank 数组中的题目顺序和 difficulty 属性
- 开心表情触发：修改 `showHappyExpression()` 中的难度判断（当前为 difficulty >= 2）
- 尺寸等级：修改CSS中的 scale-1 到 scale-7 的 transform 值（当前为1.0到1.6倍）

**fish-racing.html 可调参数**：
- 倒计时时长：修改 `timeLeft = 10` 的值（秒）
- 小鱼数量：修改 `generateAnswers(currentQuestion.answer, 5)` 中的数字（当前为5条）
- 连击奖励：修改 `if (combo % 3 === 0)` 中的数字（当前为每3题+1分）
- 答案范围：修改 generateAnswers() 中的 minAnswer 和 maxAnswer 计算（当前为±100）
- 小鱼游动速度：修改 createFish() 中的 duration 值（当前为3-7秒）
- 小鱼游动距离：修改 createFish() 中的 distance 值（当前为100-300px）

### 自定义样式

所有样式都在 `<style>` 标签中，可以：
- 修改颜色主题
- 调整动画速度
- 改变小鱼和虾的外观
- 自定义字体和布局
- 添加新的皮肤样式

## 注意事项

- 所有图形元素使用CSS绘制，无需外部图片
- 题库使用JS数组存储，便于维护和扩展
- 动画效果使用CSS @keyframes实现
- 确保触屏输入兼容性
- 代码模块化，便于在低代码平台执行
- 无外部依赖，确保离线可用
- fish-game.html 的题目按顺序循环使用，实现难度递进
- fish-game.html 的能量虾通过 difficulty 类名控制外观
- fish-game.html 的升级系统每5分升一级，共7个等级
- fish-game.html 的小鱼通过 scale 类名控制尺寸
- fish-racing.html 的小鱼颜色根据题目类型动态分配

## 开发完成状态

✅ 两套游戏已完成开发
✅ 30道题库已实现
✅ 响应式设计已完成
✅ 触屏兼容性已测试
✅ 动画效果已实现
✅ 激励机制已完善（7级升级系统，6种皮肤）
✅ 尺寸增长系统已实现

## 已知限制

- 题目数量固定为30道
- 升级间隔固定为每5分升一级
- 倒计时时长固定为10秒
- fish-game.html 的难度递进是线性的，不支持根据孩子表现动态调整
- fish-racing.html 的小鱼颜色分配逻辑固定（乘法=黄色，加减法=红色/绿色）
- 不保存游戏进度和最高分
- 不支持题目难度自适应算法
- 不支持自定义游戏参数（需修改代码）

## 未来改进方向

如需进一步优化，可以考虑：
- 添加更多题目，支持题目难度分级
- 实现本地存储，保存游戏进度和最高分
- 添加更多小鱼皮肤和解锁条件
- 支持自定义游戏参数（倒计时时长、题目数量、升级间隔等）
- 添加音效开关
- 实现题目难度自适应算法（根据孩子正确率动态调整）
- 添加家长控制面板（查看学习报告、设置难度）
- 优化 fish-game.html 的难度递进逻辑（支持跳跃式难度调整）
- 添加更多小鱼表情动画（难过、惊讶等）
- 支持 fish-racing.html 的多人竞技模式